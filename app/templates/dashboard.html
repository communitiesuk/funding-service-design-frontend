{%- from "govuk_frontend_jinja/components/tag/macro.html" import govukTag -%}
{%- from "govuk_frontend_jinja/components/button/macro.html" import govukButton -%}
{% from "partials/start-application-button.html" import startApplicationButton %}

{% extends "base.html" %}
{% block content %}
    <h1 class="govuk-heading-xl">{% trans %}Your applications{% endtrans %}</h1>
    <p class="govuk-body">
        {% trans %}You have started{% endtrans %}&nbsp{% trans count=applications|length %} {{ count }} application {% pluralize %} {{ count }} applications {% endtrans %}
        &nbsp{% trans %}using this email address{% endtrans %}.
    </p>
    {% set ns = namespace(rows = []) %}
    {% for application in applications %}
        {% set status_class %}
            {%  if application.status == 'SUBMITTED' %}
                complete-tag
            {%  elif application.status == 'NOT_STARTED' %}
                not-started-tag
            {%  elif application.status == 'IN_PROGRESS' %}
                in-progress-tag-new
            {%  elif application.status == 'READY_TO_SUBMIT' %}
                in-progress-tag-new
            {% endif %}
        {% endset %}

        {% if not application.status == 'SUBMITTED' %}
            {% set application_link = '<a class="govuk-link" href="{}">Continue application</a>'.format(url_for('routes.tasklist', application_id=application.id)) %}
        {% endif %}


    {% set row = ns.rows.append(
    [
        {
            'text': application.project_name if application.project_name else 'Untitled project'
        },
        {
            'text':  govukTag({
                'text': application.status|snake_case_to_human ,
                'classes': status_class
            })
        },
        {
            'html': application.last_edited|datetime_format_short_month if application.last_edited
        },
        {
            'html': application.reference
        },
        {
            'html': application_link
        }
    ])%}
{% endfor %}

{% if applications|length > 0 %}
    <table class="govuk-table">
        <thead class="govuk-table__head">
          <tr class="govuk-table__row">
            <th scope="col" class="govuk-table__header">{% trans %}Project name{% endtrans %}</th>
            <th scope="col" class="govuk-table__header">{% trans %}Status{% endtrans %}</th>
            <th scope="col" class="govuk-table__header">{% trans %}Last edited{% endtrans %}</th>
            <th scope="col" class="govuk-table__header">{% trans %}Application Reference{% endtrans %}</th>
            <th scope="col" class="govuk-table__header">{% trans %}Action{% endtrans %}</th>
          </tr>
        </thead>
        <tbody class="govuk-table__body">
          {{ns.rows}}
          <tr class="govuk-table__row">
            <td class="govuk-table__cell"></td>
          </tr>
        </tbody>
      </table>
{% endif %}

{{startApplicationButton(form, url_for('routes.new'), applications=applications)}}

{% endblock %}
