{% extends "base.html" %}
{% from "govuk_frontend_jinja/components/button/macro.html" import govukButton -%}
{% from "partials/tasklist_section.html" import tasklist_section %}
{% from "partials/tasklist_submit.html" import tasklist_submit %}
{% block beforeContent %}
    <a href="{{ url_for('routes.dashboard') }}" class="govuk-back-link">Back to your applications</a>
{% endblock %}
{% block pageTitle %}Task List - {{ service_title }}{% endblock %}

{% block content %}

    <div class="govuk-grid-row">
        <div class="govuk-grid-column-two-thirds">
            <span class="govuk-caption-l">{{ application_meta_data["fund_name"]|kebab_case_to_human }} {{ application_meta_data["round_name"] }}</span>
            <h1 class="govuk-heading-xl">Application for funding to save an asset in your community</h1>
            <details class="govuk-details" data-module="govuk-details">
                <summary class="govuk-details__summary">
          <span class="govuk-details__summary-text">
            Help with filling out your application
          </span>
                </summary>
                <div class="govuk-details__text">
                    <h2 class="govuk-heading govuk-heading-s">What we'll ask you for</h2>
                    <p class="govuk-body">
                        You can preview the <a class="govuk-link" href="#">full list of application questions</a>.
                    </p>
                    <p class="govuk-body">
                        We'll also ask you to upload a business plan to support the answers you've given us in the
                        management case section.
                    </p>

                    <h2 class="govuk-heading govuk-heading-s">
                        Moving through the form
                    </h2>
                    <p class="govuk-body">
                        This form is split into sections based on how it will be assessed.
                    </p>
                    <p class="govuk-body">
                        You do not have to complete it in order, or all at once.
                    </p>
                    <p class="govuk-body">
                        When you have written something in every field in a section, the section will be marked as
                        complete. You can still change your responses in sections that are marked as complete.
                    </p>

                    <h2 class="govuk-heading govuk-heading-s">
                        Saving progress and making changes
                    </h2>
                    <p class="govuk-body">
                        Your work will not save automatically. To make sure you do not lose anything, select Save and
                        continue regularly, and always before you go back or close your internet browser window.
                    </p>
                    <p class="govuk-body">
                        If you need to edit or revisit any sections, use the browser back button.
                    </p>
                    <p class="govuk-body">
                        You can edit your responses as many times as you like before you submit.
                    </p>

                    <h2 class="govuk-heading govuk-heading-s">
                        Submitting your application
                    </h2>
                    <p class="govuk-body">
                        When you have completed all sections, you'll be able to submit your application.
                    </p>
                    <p class="govuk-body">
                        Once you have submitted your application, you'll not be able to edit, add or change any
                        sections.
                    </p>

                    <h2 class="govuk-heading govuk-heading-s">
                        Get help
                    </h2>
                    <p class="govuk-body">
                        If you have any questions about the form or the fund, email us at <a
                            class="govuk-link" href="mailto:{{ contact_us_email_address }}">{{ contact_us_email_address }}</a>.
                    </p>
                    <p>Do not send any applications or attachments by email. We'll only accept applications through this
                        service.</p>


                    <h2 class="govuk-heading govuk-heading-s">
                        How we'll use your information
                    </h2>
                    <p class="govuk-body">
                        Read how we'll use the information from your application in our privacy notice.
                    </p>

                </div>
            </details>
            <h2 class="govuk-heading-s govuk-!-margin-bottom-2">Submission deadline: <span
                    class="govuk-body"> midday, {{ submission_deadline }}</span></h2>
            {% if application["status"] == application_meta_data["completed_status"] %}
                {{ tasklist_submit(application_id, application_meta_data, form, url_for('routes.submit_application')) }}
            {% elif not application["status"] == application_meta_data["submitted_status"] %}
                <h2 class="govuk-heading-s govuk-!-margin-bottom-2">
                    Status:
                    {% set completed_count = application_meta_data["number_of_completed_forms"] %}
                    {% set in_progress_count = application_meta_data["number_of_in_progress_forms"] %}
                    {% set form_count = application_meta_data["number_of_forms"] %}
                    {% if application["status"] == application_meta_data["not_started_status"] %}
                        <strong class="govuk-tag govuk-tag--grey">
                    {% elif application["status"] == application_meta_data["in_progress_status"] %}
                        <strong class="govuk-tag govuk-tag--blue">
                    {% elif application["status"] == application_meta_data["completed_status"] %}
                        <strong class="govuk-tag govuk-tag--green">
                    {% endif %}
                    {{ application.status|snake_case_to_human }}
                    </strong>
                </h2>
                <p class="govuk-body govuk-!-margin-bottom-7">
                    {% if application_meta_data["number_of_completed_forms"] == 0 %}
                        None of the forms have been completed.
                    {% else %}
                        You have completed
                        {{ application_meta_data["number_of_completed_forms"] }} of
                        {{ application_meta_data["number_of_forms"] }} forms.
                    {% endif %}
                </p>
            {% endif %}

            <ol class="app-task-list">
                {% for section_name, section_data in application.sections.items() %}
                    {{ tasklist_section(section_name, section_data["forms_within_section"], section_data["section_weighting"], application_meta_data,
      loop.index) }}
                {% endfor %}
            </ol>
        </div>
    </div>


{% endblock %}
